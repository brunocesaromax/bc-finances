<?xml version="1.0"?>
<!DOCTYPE module PUBLIC
          "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
          "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!--
    PHASE 2: Checkstyle CRITICAL - Only rules that must not be violated.

    GOAL: Gradual implementation without breaking existing build.

    This configuration includes ONLY:
    - Security critical rules
    - Violations that can cause bugs
    - Minimal formatting rules

    EXCLUSIONS (optional for future phases):
    - Javadoc (many classes without docs)
    - Indentation (legacy code with tabs)
    - Import order (many files to fix)
    - Naming conventions (legacy patterns)
-->

<module name="Checker">
  <!-- .editorconfig: charset = utf-8 -->
  <property name="charset" value="UTF-8"/>

  <!-- Errors that break the build must be ERROR -->
  <property name="severity" value="error"/>

  <property name="fileExtensions" value="java, properties, xml"/>

  <!-- Excludes all 'module-info.java' files -->
  <module name="BeforeExecutionExclusionFileFilter">
    <property name="fileNamePattern" value="module\-info\.java$"/>
  </module>

  <!-- PHASE 1: ONLY CRITICAL SECURITY RULES -->

  <!-- Security: Prevent dangerous unicode escapes -->
  <module name="RegexpSingleline">
    <property name="format" value="\\u00(09|0(a|A)|0(c|C)|0(d|D)|22|27|5(C|c))|\\(0(10|11|12|14|15|42|47)|134)"/>
    <property name="message" value="Avoid using Unicode escapes (security risk)."/>
  </module>

  <!-- Security: No obvious passwords/secrets -->
<!--  <module name="RegexpSingleline">-->
<!--    <property name="format" value="(?i)(password|secret|key|token)\s*=\s*[&quot;'][^&quot;']{8,}[&quot;']"/>-->
<!--    <property name="message" value="Potential hardcoded credential detected."/>-->
<!--  </module>-->

  <module name="TreeWalker">

    <!-- Critical: Unused imports -->
    <module name="UnusedImports">
      <property name="processJavadoc" value="false"/>
    </module>

    <!-- Critical: No star imports -->
    <module name="AvoidStarImport"/>

    <!-- Critical: File structure basics -->
    <module name="OuterTypeFilename"/>
    <module name="OneTopLevelClass"/>

    <!-- Critical: Security - prevent dangerous constructs -->
    <module name="IllegalTokenText">
      <property name="tokens" value="STRING_LITERAL, CHAR_LITERAL"/>
      <property name="format" value="\\u00(09|0(a|A)|0(c|C)|0(d|D)|22|27|5(C|c))|\\(0(10|11|12|14|15|42|47)|134)"/>
      <property name="message" value="Consider using special escape sequence instead of octal value or Unicode escaped value."/>
    </module>

    <!-- Critical: Empty catch blocks can hide errors -->
    <module name="EmptyCatchBlock">
      <property name="exceptionVariableName" value="expected|ignore"/>
    </module>

    <!-- Critical: Missing switch default can cause bugs -->
    <module name="MissingSwitchDefault"/>

    <!-- Critical: Fall through in switch can cause bugs -->
    <module name="FallThrough"/>

    <!-- Critical: Security - avoid finalizers -->
    <module name="NoFinalizer"/>
    <module name="SuperFinalize"/>
    <module name="SuperClone"/>

    <!-- Critical: Multiple variable declarations can be confusing -->
    <module name="MultipleVariableDeclarations"/>

    <!-- Critical: One statement per line for readability -->
    <module name="OneStatementPerLine"/>

  </module>

</module>
